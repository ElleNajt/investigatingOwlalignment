#!/bin/bash
# Create temporary bin directory for python overrides
TEMP_BIN_DIR="$PWD/.direnv/bin"
mkdir -p "$TEMP_BIN_DIR"

# Create python wrapper scripts that use venv
cat > "$TEMP_BIN_DIR/python" << 'INNER_EOF'
#!/bin/bash
echo "Use virtual environment python instead of system python"
if [ -f "./venv/bin/python" ]; then
    exec ./venv/bin/python "$@"
elif [ -f "./.venv/bin/python" ]; then
    exec ./.venv/bin/python "$@"
else
    echo "No virtual environment found. Please create one with: python -m venv venv"
    exit 1
fi
INNER_EOF

cat > "$TEMP_BIN_DIR/python3" << 'INNER_EOF'
#!/bin/bash
echo "Use virtual environment python instead of system python"
if [ -f "./venv/bin/python" ]; then
    exec ./venv/bin/python "$@"
elif [ -f "./.venv/bin/python" ]; then
    exec ./.venv/bin/python "$@"
else
    echo "No virtual environment found. Please create one with: python -m venv venv"
    exit 1
fi
INNER_EOF

cat > "$TEMP_BIN_DIR/pip" << 'INNER_EOF'
#!/bin/bash
echo "Use virtual environment pip instead of system pip"
if [ -f "./venv/bin/pip" ]; then
    exec ./venv/bin/pip "$@"
elif [ -f "./.venv/bin/pip" ]; then
    exec ./.venv/bin/pip "$@"
else
    echo "No virtual environment found. Please create one with: python -m venv venv"
    exit 1
fi
INNER_EOF

cat > "$TEMP_BIN_DIR/pip3" << 'INNER_EOF'
#!/bin/bash
echo "Use virtual environment pip instead of system pip"
if [ -f "./venv/bin/pip" ]; then
    exec ./venv/bin/pip "$@"
elif [ -f "./.venv/bin/pip" ]; then
    exec ./.venv/bin/pip "$@"
else
    echo "No virtual environment found. Please create one with: python -m venv venv"
    exit 1
fi
INNER_EOF

# Make them executable
chmod +x "$TEMP_BIN_DIR/python" "$TEMP_BIN_DIR/python3" "$TEMP_BIN_DIR/pip" "$TEMP_BIN_DIR/pip3"

# Add to PATH
export PATH="$TEMP_BIN_DIR:$PATH"